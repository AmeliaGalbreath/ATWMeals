<ng-template #t let-fill="fill">
  <i class="bi-star-fill">
      <i *ngIf="fill > 0" class="bi-star-fill filled" [style.width.%]="fill"></i>
  </i>
</ng-template>

<div class="book">

    <!-- For Next/Prev Controls -->
    <input type="checkbox" style="opacity:0;" id="c1">
    <input type="checkbox" style="opacity:0;" id="c2">
    <input type="checkbox" style="opacity:0;" id="c3">

    <!-- Book Cover  -->
    <div id="cover">
      <!-- <img src="cover.jpg" alt="Cover"> -->
    </div>

    <!-- Pages -->
    <div class="flip-book">

      <!-- Page 1 -->
      <div class="flip" id="p1">
        <div class="front">
          <img id="passportImage" src="https://media.istockphoto.com/id/187552400/photo/american-passport-with-biometric-data-in-microchip.jpg?s=612x612&w=0&k=20&c=3lrWIK4li4Q2V3h6fAGMU1_mJO8CQc0pbbA_PezVj4w=" alt="">
          <label for="c1" class="next-btn">OPEN</label>
        </div>
        <div class="back" *ngIf="user">
          <p class="Amy">This passport belongs to:<br><br><span>{{user.name}}</span></p>
          <img id="passportFade" src="https://www.pngall.com/wp-content/uploads/2/Travel-PNG-Download-Image.png">
          <label for="c1" class="back-btn">CLOSE</label>
        </div>
      </div>

      <!-- Page 2 -->
      <div class="flip" id="p2">
        <div class="front" *ngIf="user">
          
          <br><br><br><br>You have experienced {{totalUserCountryCount()}} countries!
          <br><br><br>Click a country's flag to look back on your visit!<br><br>
          <div>
            <ng-container *ngFor="let passport of user.passports">
              <button type="button" class="button" (click)="onSelect(passport.country.name)">
                <label for="c2"><img id="flag" src="{{passport.country.flagURL}}"></label>
                </button>
            </ng-container>
        </div>

          <!--<label for="c2" class="next-btn">NEXT</label>-->
        </div>
        <div class="back">
          <br><br><br><img id="passportFade" src="https://www.pngall.com/wp-content/uploads/2/Travel-PNG-Download-Image.png">
          <label for="c2" class="back-btn">BACK</label>
        </div>
      </div>

      <!-- Page 3 -->
      <div class="flip" id="p3">
        <div class="front" *ngIf="user">
          <div class="form-group">
            <br><br><br><label for="ratedMeals">This is how you felt about these meals: </label><br><br>

            <ng-container *ngFor="let mealRating of user.mealRatings">
              <ng-container *ngIf="mealRating.countryName === selectedPassportCountry">
                <ng-container>
                  <p *ngIf="getMealName(mealRating.mealId)">{{getMealName(mealRating.mealId)}} | 
                    <ngb-rating [rate]="userMealRating(mealRating.mealId)" [formControl]="ctrl" [starTemplate]="t" [max]="5" [readonly]="true"></ngb-rating>
                    <br>({{userMealRating(mealRating.mealId)}} of 5 stars)
                  </p>
                  <button *ngIf="!getMealName(mealRating.mealId)" (click)="setMealName(mealRating.mealId)">
                  </button>
                </ng-container>
              </ng-container>
            </ng-container>

            <select [(ngModel)]="selectedMealId" (change)="onMealSelected()">
              <option [ngValue]="null" disabled>Select a meal</option>
              <option *ngFor="let mealRating of user.mealRatings" [ngValue]="mealRating.mealId">
                {{ getMealName(mealRating.mealId) }}
              </option>
            </select>
            <div *ngIf="selectedMealData">
              {{ selectedMealData }}
            </div>
          </div>
          
          <!--<label for="c3" class="next-btn">NEXT</label>-->
        </div>
        <div class="back">
          <label for="c3" class="back-btn">BACK</label>
        </div>
      </div>
    </div>
  </div>

  <select id="ratedMeals" name="ratedMeals" ngModel class="form-control">
    <ng-container *ngFor="let mealRating of user.mealRatings">
      
      <ng-container *ngIf="mealRating.countryName === selectedPassportCountry">
        <ng-container *ngIf="setMealName(mealRating.mealId)">
        <option value="{{mealRating.mealId}}">{{mealRating.mealId}}</option>
        </ng-container>
      </ng-container>
    </ng-container>

  </select>
